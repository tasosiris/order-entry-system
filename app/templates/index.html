<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Entry System - Hedge Fund Grade</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="https://unpkg.com/htmx.org@1.9.2"></script>
    <script src="/static/js/main.js" defer></script>
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #3b82f6;
            --success-color: #10b981;
            --danger-color: #ef4444;
            --background-dark: #111827;
            --card-dark: #1f2937;
            --text-dark: #f3f4f6;
            --border-dark: #374151;
        }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background: var(--background-dark);
            color: var(--text-dark);
        }

        body.light-mode {
            --background-dark: #f3f4f6;
            --card-dark: #ffffff;
            --text-dark: #111827;
            --border-dark: #e5e7eb;
        }

        header {
            background: var(--card-dark);
            padding: 1rem 2rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-dark);
        }

        .header-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        main {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 2rem;
        }

        .panel {
            background: var(--card-dark);
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-dark);
        }

        .instrument-buttons {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .instrument-btn {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border-dark);
            border-radius: 0.5rem;
            background: transparent;
            color: var(--text-dark);
            cursor: pointer;
            transition: all 0.2s;
        }

        .instrument-btn.active {
            background: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }

        .order-form {
            display: grid;
            gap: 1rem;
        }

        .order-form input, .order-form select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-dark);
            border-radius: 0.5rem;
            background: var(--card-dark);
            color: var(--text-dark);
        }

        .actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 1rem;
        }

        .buy-btn, .sell-btn {
            padding: 1rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.1s;
        }

        .buy-btn {
            background: var(--success-color);
            color: white;
        }

        .sell-btn {
            background: var(--danger-color);
            color: white;
        }

        .buy-btn:hover, .sell-btn:hover {
            transform: translateY(-1px);
        }

        .orders-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .orders-table th, .orders-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border-dark);
        }

        .orders-table th {
            font-weight: 600;
            background: var(--card-dark);
        }

        .tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            border-bottom: 1px solid var(--border-dark);
            padding-bottom: 0.5rem;
        }

        .tab-btn {
            padding: 0.5rem 1rem;
            border: none;
            background: transparent;
            color: var(--text-dark);
            cursor: pointer;
            border-radius: 0.5rem;
            transition: background-color 0.2s;
        }

        .tab-btn.active {
            background: var(--primary-color);
            color: white;
        }

        .dark-pool-stats {
            margin-top: 2rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .stat-item {
            background: var(--card-dark);
            padding: 1rem;
            border-radius: 0.5rem;
            border: 1px solid var(--border-dark);
        }

        .stat-label {
            font-size: 0.875rem;
            color: #6b7280;
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 1.25rem;
            font-weight: 600;
        }

        #theme-toggle {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: 1px solid var(--border-dark);
            background: transparent;
            color: var(--text-dark);
            cursor: pointer;
        }

        #connection-status {
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            background: var(--success-color);
            color: white;
            font-size: 0.875rem;
        }

        .ticker-search {
            position: relative;
        }

        .ticker-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--card-dark);
            border: 1px solid var(--border-dark);
            border-radius: 0.5rem;
            margin-top: 0.25rem;
            max-height: 200px;
            overflow-y: auto;
            z-index: 10;
        }

        .ticker-item {
            padding: 0.75rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .ticker-item:hover {
            background: var(--border-dark);
        }

        .routing-option {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--border-dark);
            transition: .4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--primary-color);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        @media (max-width: 1024px) {
            main {
                grid-template-columns: 1fr;
            }
        }
        
        /* React Component Styling */
        #react-component-container {
            min-height: 400px;
            width: 100%;
            background-color: var(--card-dark);
            border-radius: 0.5rem;
            overflow: hidden;
            position: relative;
        }
        
        #react-component-container::before {
            content: "Loading chart...";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--text-dark);
            opacity: 0.6;
        }
        
        #react-component-container div[data-command] {
            min-height: 400px;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
    </style>
    <script>
        // React-style component utilities for complex HTML insertion
        function createMarkup(id, height, width) {
            return {__html: `<div data-command='{"id":"${id}","height":${height},"width":${width}}'></div>`};
        }
        
        function renderDiv(element, markup) {
            element.innerHTML = markup.__html;
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            // Example usage
            const containerEl = document.getElementById('react-component-container');
            if (containerEl) {
                renderDiv(containerEl, createMarkup('orderbook-component', 600, 400));
            }
        });
    </script>
</head>
<body class="dark-mode">
    <header>
        <h1>Order Entry System</h1>
        <div class="header-controls">
            <button id="theme-toggle">
                <span>🌙 Dark Mode</span>
            </button>
            <span id="connection-status">Connected</span>
        </div>
    </header>
    
    <main>
        <!-- Order Entry Panel -->
        <section class="panel order-entry">
            <h2>Order Entry</h2>
            
            <!-- Instrument Selection -->
            <div class="instrument-buttons" id="instrument-buttons">
                <!-- Will be populated by JS -->
            </div>
            
            <form class="order-form" hx-post="/api/orders" hx-trigger="submit" hx-target="#order-status">
                <!-- Symbol Selection -->
                <div class="ticker-search">
                    <label for="symbol">Symbol</label>
                    <input 
                        type="text" 
                        id="symbol" 
                        name="symbol" 
                        required 
                        placeholder="Search ticker..."
                    >
                    <div class="ticker-suggestions" id="ticker-suggestions">
                        <!-- Will be populated by JS -->
                    </div>
                </div>
                
                <!-- Order Type Selection -->
                <div class="order-type-options">
                    <label>Order Type</label>
                    <div class="order-options">
                        <div>
                            <input type="radio" id="limit-order" name="order_type" value="limit">
                            <label for="limit-order">Limit</label>
                        </div>
                        <div>
                            <input type="radio" id="market-order" name="order_type" value="market">
                            <label for="market-order">Market</label>
                        </div>
                    </div>
                </div>
                
                <!-- Price (only visible for limit orders) -->
                <div>
                    <label for="price">Price</label>
                    <input type="number" id="price" name="price" step="0.01" min="0.01" required placeholder="Enter price">
                </div>
                
                <!-- Quantity -->
                <div>
                    <label for="quantity">Quantity</label>
                    <input type="number" id="quantity" name="quantity" step="0.0001" min="0.0001" required placeholder="Enter quantity">
                </div>
                
                <!-- Time-in-Force Options -->
                <div>
                    <label for="tif">Time in Force</label>
                    <select id="tif" name="tif">
                        <option value="day">Day</option>
                        <option value="gtc">Good Till Cancelled</option>
                        <option value="ioc">Immediate or Cancel</option>
                        <option value="fok">Fill or Kill</option>
                    </select>
                </div>
                
                <!-- Dark Pool Routing Option -->
                <div class="routing-option">
                    <div class="routing-toggle">
                        <label class="toggle-switch">
                            <input type="checkbox" name="internal">
                            <span class="toggle-slider"></span>
                        </label>
                        <span>Route to Dark Pool</span>
                        <div class="tooltip">
                            <span>?</span>
                            <div class="tooltip-text">
                                Dark Pool orders are matched internally before being sent to external markets. This can reduce market impact and improve execution quality.
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Buy/Sell Buttons -->
                <div class="actions">
                    <button type="submit" class="buy-btn" data-order-type="buy">BUY</button>
                    <button type="submit" class="sell-btn" data-order-type="sell">SELL</button>
                    <input type="hidden" id="type" name="type" value="buy">
                </div>
            </form>
            
            <div id="order-status" class="status-message"></div>
            
            <div id="latency-stats" class="latency-indicator">
                Avg. Latency: -- ms
            </div>
            
            <!-- Order Management Section -->
            <div class="order-management">
                <h3 class="mt-4">Orders</h3>
                <div class="tabs">
                    <button class="tab-btn active" data-tab="open">Open</button>
                    <button class="tab-btn" data-tab="filled">Filled</button>
                    <button class="tab-btn" data-tab="cancelled">Cancelled</button>
                </div>
                
                <!-- Order Tables -->
                <div class="panel order-tables">
                    <div class="order-table-section" id="open-orders-section">
                        <h3>Open Orders</h3>
                        <table class="orders-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Symbol</th>
                                    <th>Type</th>
                                    <th>Price</th>
                                    <th>Quantity</th>
                                    <th>Time</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="open-orders-body" hx-get="/api/orders/open" hx-trigger="load, every 2s" hx-swap="innerHTML">
                                <tr><td colspan="7">Loading orders...</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="order-table-section" id="filled-orders-section" style="display: none;">
                        <h3>Filled Orders</h3>
                        <table class="orders-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Symbol</th>
                                    <th>Type</th>
                                    <th>Fill Price</th>
                                    <th>Quantity</th>
                                    <th>Time</th>
                                </tr>
                            </thead>
                            <tbody id="filled-orders-body" hx-get="/api/orders/filled" hx-trigger="load, every 2s" hx-swap="innerHTML">
                                <tr><td colspan="6">Loading orders...</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="order-table-section" id="cancelled-orders-section" style="display: none;">
                        <h3>Cancelled Orders</h3>
                        <table class="orders-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Symbol</th>
                                    <th>Type</th>
                                    <th>Price</th>
                                    <th>Quantity</th>
                                    <th>Time</th>
                                </tr>
                            </thead>
                            <tbody id="cancelled-orders-body" hx-get="/api/orders/cancelled" hx-trigger="load, every 2s" hx-swap="innerHTML">
                                <tr><td colspan="6">Loading orders...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Dark Pool Stats Section -->
                <div class="dark-pool-stats mt-4" id="dark-pool-stats">
                    <h3>Dark Pool Stats</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-label">Status</div>
                            <div class="stat-value" id="dark-pool-status">Loading...</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Buy Orders</div>
                            <div class="stat-value" id="dark-pool-buy-orders">--</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Sell Orders</div>
                            <div class="stat-value" id="dark-pool-sell-orders">--</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Trades</div>
                            <div class="stat-value" id="dark-pool-trades">--</div>
                        </div>
                    </div>
                    <div class="stats-loading" id="dark-pool-loading">
                        <p>Loading dark pool statistics...</p>
                    </div>
                    <div class="stats-error" id="dark-pool-error" style="display: none; color: #f44336;">
                        <p>Could not load dark pool statistics</p>
                        <button class="retry-btn" id="dark-pool-retry">Retry</button>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Order Book Panel -->
        <section class="panel">
            <h2>Order Book</h2>
            <div id="orderbook-container">
                <div class="order-book-controls">
                    <label class="toggle-switch order-book-toggle">
                        <input type="checkbox" id="include-internal" onchange="loadOrderBook()">
                        <span class="toggle-slider"></span>
                    </label>
                    <span>Show Dark Pool Orders</span>
                </div>
                <div id="order-book" class="order-book">
                    <div class="book-side">
                        <h3>Bids</h3>
                        <table class="bids" id="bids-table">
                            <thead>
                                <tr>
                                    <th>Price</th>
                                    <th>Quantity</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody id="bids-body">
                                <tr><td colspan="3">Loading...</td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="book-side">
                        <h3>Asks</h3>
                        <table class="asks" id="asks-table">
                            <thead>
                                <tr>
                                    <th>Price</th>
                                    <th>Quantity</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody id="asks-body">
                                <tr><td colspan="3">Loading...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <script>
                function loadOrderBook() {
                    const includeInternal = document.getElementById('include-internal').checked;
                    fetch(`/api/orderbook?include_internal=${includeInternal}`)
                        .then(response => {
                            if (!response.ok) {
                                if (response.status === 404) {
                                    console.error('Error 404: Order book endpoint not found');
                                    return { bids: [], asks: [] };
                                }
                                throw new Error(`Error ${response.status}: ${response.statusText}`);
                            }
                            return response.json();
                        })
                        .then(data => {
                            const bidsBody = document.getElementById('bids-body');
                            bidsBody.innerHTML = '';
                            if (!data.bids || data.bids.length === 0) {
                                const row = document.createElement('tr');
                                row.innerHTML = '<td colspan=3>No buy orders</td>';
                                bidsBody.appendChild(row);
                            } else {
                                data.bids.forEach(order => {
                                    const row = document.createElement('tr');
                                    row.className = 'bid';
                                    const isInternal = order.internal_match === 'True';
                                    row.innerHTML = `<td class="price">${parseFloat(order.price).toFixed(2)} ${isInternal ? '<span class="badge internal-badge">DARK</span>' : ''}</td><td class="quantity">${parseFloat(order.quantity).toFixed(4)}</td><td class="total">${(parseFloat(order.price) * parseFloat(order.quantity)).toFixed(2)}</td>`;
                                    bidsBody.appendChild(row);
                                });
                            }
                            const asksBody = document.getElementById('asks-body');
                            asksBody.innerHTML = '';
                            if (!data.asks || data.asks.length === 0) {
                                const row = document.createElement('tr');
                                row.innerHTML = '<td colspan=3>No sell orders</td>';
                                asksBody.appendChild(row);
                            } else {
                                data.asks.forEach(order => {
                                    const row = document.createElement('tr');
                                    row.className = 'ask';
                                    const isInternal = order.internal_match === 'True';
                                    row.innerHTML = `<td class="price">${parseFloat(order.price).toFixed(2)} ${isInternal ? '<span class="badge internal-badge">DARK</span>' : ''}</td><td class="quantity">${parseFloat(order.quantity).toFixed(4)}</td><td class="total">${(parseFloat(order.price) * parseFloat(order.quantity)).toFixed(2)}</td>`;
                                    asksBody.appendChild(row);
                                });
                            }
                        })
                        .catch(error => {
                            console.error('Error fetching order book:', error);
                            const bidsBody = document.getElementById('bids-body');
                            const asksBody = document.getElementById('asks-body');
                            bidsBody.innerHTML = '<tr><td colspan="3">Could not load order book data</td></tr>';
                            asksBody.innerHTML = '<tr><td colspan="3">Could not load order book data</td></tr>';
                        });
                }

                // Initialize order book on page load
                document.addEventListener('DOMContentLoaded', function() {
                    loadOrderBook();
                    // Refresh order book every few seconds
                    setInterval(loadOrderBook, 2000);
                });
            </script>
        </section>
        
        <!-- Dynamic React-Style Component -->
        <section class="panel">
            <h2>Market Visualization</h2>
            <div id="react-component-container"></div>
            <script>
                // Initialize with specific options
                document.addEventListener('DOMContentLoaded', function() {
                    const containerEl = document.getElementById('react-component-container');
                    if (containerEl) {
                        const options = {
                            id: "market-chart",
                            height: 400,
                            width: containerEl.clientWidth || 600,
                            settings: {
                                showVolume: true,
                                timeframe: "1D",
                                theme: document.body.classList.contains('light-mode') ? "light" : "dark"
                            }
                        };
                        
                        renderDiv(containerEl, {
                            __html: `<div data-command='${JSON.stringify(options)}'></div>`
                        });
                    }
                    
                    // Update theme when it changes
                    const observer = new MutationObserver((mutations) => {
                        mutations.forEach((mutation) => {
                            if (mutation.attributeName === 'class') {
                                const isDarkMode = !document.body.classList.contains('light-mode');
                                updateChartTheme(isDarkMode ? 'dark' : 'light');
                            }
                        });
                    });
                    
                    observer.observe(document.body, { attributes: true });
                    
                    function updateChartTheme(theme) {
                        const containerEl = document.getElementById('react-component-container');
                        if (containerEl) {
                            const chartEl = containerEl.querySelector('[data-command]');
                            if (chartEl) {
                                const options = JSON.parse(chartEl.getAttribute('data-command'));
                                options.settings.theme = theme;
                                chartEl.setAttribute('data-command', JSON.stringify(options));
                                // In a real app, you would trigger a chart redraw here
                            }
                        }
                    }
                });
            </script>
        </section>
        
        <!-- Trades Panel -->
        <section class="panel trades-panel">
            <h2>Recent Trades</h2>
            <table id="trades-table">
                <thead>
                    <tr>
                        <th>Time</th>
                        <th>Price</th>
                        <th>Quantity</th>
                    </tr>
                </thead>
                <tbody id="trades-body">
                    <tr>
                        <td colspan="3">Loading recent trades...</td>
                    </tr>
                </tbody>
            </table>
        </section>
    </main>
    
    <div id="notification" class="notification"></div>
    
    <div id="websocket-error" style="display: none; background-color: #f44336; color: white; padding: 1rem; text-align: center; position: fixed; top: 0; left: 0; right: 0; z-index: 1000;"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Theme toggle
            const body = document.body;
            const themeToggle = document.getElementById('theme-toggle');
            const themeToggleText = themeToggle.querySelector('span');
            
            themeToggle.addEventListener('click', () => {
                body.classList.toggle('light-mode');
                updateThemeText();
            });

            function updateThemeText() {
                const isDark = !body.classList.contains('light-mode');
                themeToggleText.textContent = isDark ? '☀️ Light Mode' : '🌙 Dark Mode';
            }

            // Instrument buttons
            const instruments = ['Stocks', 'Futures', 'Options', 'Crypto'];
            const instrumentButtons = document.getElementById('instrument-buttons');
            let activeInstrument = 'Stocks';

            instruments.forEach(instrument => {
                const button = document.createElement('button');
                button.type = 'button';
                button.className = 'instrument-btn';
                button.textContent = instrument;
                if (instrument === activeInstrument) {
                    button.classList.add('active');
                }
                
                button.addEventListener('click', () => {
                    document.querySelectorAll('.instrument-btn').forEach(btn => 
                        btn.classList.remove('active'));
                    button.classList.add('active');
                    activeInstrument = instrument;
                    updateTickerSuggestions();
                });
                
                instrumentButtons.appendChild(button);
            });

            // Ticker search functionality
            const symbolInput = document.getElementById('symbol');
            const suggestionsList = document.getElementById('ticker-suggestions');
            
            function updateTickerSuggestions() {
                const ticker = symbolInput.value;
                if (ticker.length <= 1) {
                    suggestionsList.style.display = 'none';
                    return;
                }

                let suggestions = [];
                switch(activeInstrument) {
                    case 'Stocks':
                        suggestions = ['AAPL', 'MSFT', 'GOOGL', 'AMZN', 'META'];
                        break;
                    case 'Crypto':
                        suggestions = ['BTC-USD', 'ETH-USD', 'SOL-USD', 'AVAX-USD'];
                        break;
                    case 'Futures':
                        suggestions = ['ES', 'NQ', 'CL', 'GC', 'ZB'];
                        break;
                    case 'Options':
                        suggestions = ['AAPL230915C180', 'SPY230915P410', 'QQQ231020C380'];
                        break;
                }

                suggestions = suggestions.filter(s => 
                    s.toLowerCase().includes(ticker.toLowerCase()));

                if (suggestions.length > 0) {
                    suggestionsList.innerHTML = '';
                    suggestions.forEach(suggestion => {
                        const div = document.createElement('div');
                        div.className = 'ticker-item';
                        div.textContent = suggestion;
                        div.addEventListener('click', () => {
                            symbolInput.value = suggestion;
                            suggestionsList.style.display = 'none';
                        });
                        suggestionsList.appendChild(div);
                    });
                    suggestionsList.style.display = 'block';
                } else {
                    suggestionsList.style.display = 'none';
                }
            }

            symbolInput.addEventListener('input', updateTickerSuggestions);
            symbolInput.addEventListener('focus', updateTickerSuggestions);
            symbolInput.addEventListener('blur', () => {
                setTimeout(() => {
                    suggestionsList.style.display = 'none';
                }, 200);
            });

            // Order type radio buttons
            const orderTypeInputs = document.querySelectorAll('input[name="order_type"]');
            const priceField = document.getElementById('price').parentElement;

            orderTypeInputs.forEach(input => {
                input.addEventListener('change', () => {
                    priceField.style.display = 
                        input.value === 'limit' ? 'block' : 'none';
                });
            });

            // Tab switching functionality
            const tabs = document.querySelectorAll('.tab-btn');
            const orderSections = document.querySelectorAll('.order-table-section');

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // Remove active class from all tabs
                    tabs.forEach(t => t.classList.remove('active'));
                    // Add active class to clicked tab
                    tab.classList.add('active');
                    
                    // Hide all sections
                    orderSections.forEach(section => {
                        section.style.display = 'none';
                    });
                    
                    // Show selected section
                    const targetSection = document.getElementById(`${tab.dataset.tab}-orders-section`);
                    if (targetSection) {
                        targetSection.style.display = 'block';
                    }
                });
            });

            // Dark Pool Stats functionality
            function fetchDarkPoolStats() {
                const loading = document.getElementById('dark-pool-loading');
                const error = document.getElementById('dark-pool-error');
                
                loading.style.display = 'block';
                error.style.display = 'none';

                fetch('/api/darkpool/status')
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`Error ${response.status}: ${response.statusText}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        document.getElementById('dark-pool-status').textContent = data.enabled ? 'Enabled' : 'Disabled';
                        document.getElementById('dark-pool-buy-orders').textContent = data.buy_orders;
                        document.getElementById('dark-pool-sell-orders').textContent = data.sell_orders;
                        document.getElementById('dark-pool-trades').textContent = data.trades;
                        loading.style.display = 'none';
                    })
                    .catch(err => {
                        console.error('Error fetching dark pool stats:', err);
                        loading.style.display = 'none';
                        error.style.display = 'block';
                    });
            }

            // Initial fetch and setup interval
            fetchDarkPoolStats();
            setInterval(fetchDarkPoolStats, 10000);

            // Retry button functionality
            document.getElementById('dark-pool-retry').addEventListener('click', fetchDarkPoolStats);

            // Buy/Sell button functionality
            const buyButton = document.querySelector('.buy-btn');
            const sellButton = document.querySelector('.sell-btn');
            const typeInput = document.getElementById('type');

            buyButton.addEventListener('click', () => {
                typeInput.value = 'buy';
            });

            sellButton.addEventListener('click', () => {
                typeInput.value = 'sell';
            });
        });
    </script>
</body>
</html> 